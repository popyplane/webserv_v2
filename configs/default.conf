# This is the default configuration for your webserv.
# It's configured to work seamlessly with your current 'www' directory structure.

server {
	listen 8080; # The port your server will listen on for incoming HTTP requests.
	server_name localhost; # The domain name your server responds to (e.g., when you use curl localhost:8080).

	# MAIN DOCUMENT ROOT:
	# All paths in client requests will be resolved relative to this directory.
	# './www' means the 'www' directory located in the same folder where you execute your webserv binary.
	root www; 

	# DEFAULT INDEX FILES (for directories without specific location blocks):
	# If a request comes for a directory (e.g., http://localhost:8080/) and no specific index is found,
	# the server will look for these files directly in the 'root' (./www/).
	# In your current setup, 'index.html' is inside 'www/html/', so the root '/' won't find it directly.
	# We will handle the actual index.html for '/' in a specific location block below.
	index index.html index.htm; # These are general defaults, overridden by location / below.

	# AUTOINDEX:
	# If 'on', enables automatic directory listings when a directory is requested
	# and no 'index' file is found within that directory.
	autoindex on; 

	# ERROR PAGES:
	# Custom error pages for specific HTTP status codes.
	# Paths are relative to the 'root' directive set above (e.g., './www/errors/404.html').
	error_page 403 /errors/403.html; # Forbidden
	error_page 404 /errors/404.html; # Not Found
	error_page 405 /errors/405.html; # Method Not Allowed
	error_page 413 /errors/413.html; # Payload Too Large (e.g., file upload too big)
	error_page 500 /errors/500.html; # Internal Server Error

	# CLIENT MAX BODY SIZE:
	# The maximum allowed size of the client request body (e.g., for POST requests or file uploads).
	# '1m' means 1 megabyte. Set this to prevent excessively large requests.
	client_max_body_size 10; 

	# ------------------------------------------------------------------
	# LOCATION BLOCKS: Define specific behaviors for different URL paths.
	# ------------------------------------------------------------------

	# LOCATION / (ROOT PATH):
	# This block handles requests to the server's root (e.g., http://localhost:8080/).
	location / {
		# This tells the server that if someone requests '/', it should serve 'index.html' from the 'html/' subdirectory.
		# It resolves to './www/html/index.html' based on the server's 'root ./www;'.
		index html/index.html; 
		
		# You can explicitly set autoindex off here if you don't want a listing for the root of 'www'.
		# autoindex off; 
	}

	# LOCATION /html:
	# This block handles requests starting with /html/ (e.g., http://localhost:8080/html/about.html).
	location /html {
		# The root is already ./www. So a request for /html/about.html will look for ./www/html/about.html.
		# index index.html; # Not strictly needed here if index is already defined at server level, but can be explicit.
		autoindex on; # Ensures directory listing for www/html/directory_listing_test/
	}

	# LOCATION /images:
	# Handles requests for images (e.g., http://localhost:8080/images/logo.jpg).
	location /images {
		# This path is also relative to the server's 'root ./www;', so it correctly points to './www/images/'.
		allowed_methods GET; # Only allow GET requests for images.
	}

	# LOCATION /uploads:
	# This block is for handling file uploads via POST requests.
	location /uploads {
		allowed_methods POST GET; # Only allow POST requests to this path.
		# Specifies where uploaded files should be stored.
		# This path is relative to the webserv executable's current working directory.
		upload_store ./www/uploads; 
		client_max_body_size 10m; # Allows larger file uploads specifically for this path.
	}

	# LOCATION /cgi-bin:
	# This block configures your server to execute CGI scripts.
	location /cgi-bin {
		allowed_methods GET POST; # Allow both GET and POST for CGI scripts.
		# Map file extensions to their corresponding absolute CGI interpreter paths.
		# **IMPORTANT**: '/usr/bin/python3' MUST be the actual, absolute path to your Python 3 interpreter.
		# You can find it by typing 'which python3' in your terminal.
		cgi_extension .py;           # The file extension it handles
		cgi_path /usr/bin/python3;   # Absolute path to the Python interpreter
	}

	# You can add more location blocks as needed for specific paths or functionalities.
}